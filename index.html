<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>供应链ERP系统 - 首页看板</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- 配置Tailwind自定义主题 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            success: '#52C41A',
            warning: '#FAAD14',
            danger: '#FF4D4F',
            info: '#722ED1',
            gray: {
              100: '#F5F7FA',
              200: '#E5E6EB',
              300: '#C9CDD4',
              400: '#86909C',
              500: '#4E5969',
              600: '#272E3B',
              700: '#1D2129',
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card {
        @apply bg-white rounded-xl shadow-sm border border-gray-200 p-5 transition-all duration-300 hover:shadow-md;
      }
      .stat-card {
        @apply card flex flex-col gap-2;
      }
      .badge {
        @apply text-xs px-2 py-0.5 rounded-full font-medium;
      }
      .period-btn {
        @apply px-3 py-1 text-sm rounded-md transition-colors;
      }
      .period-btn.active {
        @apply bg-primary text-white;
      }
      .period-btn.inactive {
        @apply text-gray-500 hover:bg-gray-100;
      }
    }
  </style>
  
  <style>
    /* 确保页面可以滚动 */
    html, body {
      height: 100%;
      overflow: hidden;
    }
    
    /* 自定义滚动条样式 */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
  </style>
</head>
<body class="font-inter bg-gray-100 text-gray-700 min-h-screen">
  <!-- 主内容区 -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <!-- 页面内容 - 确保可滚动 -->
    <main class="flex-1 overflow-y-auto p-6 bg-gray-100" style="height: calc(100vh);">
      
      <!-- 周期选择器 - 全局周期控制 -->
      <div class="mb-6 flex justify-end gap-2">
        <span class="text-sm text-gray-500 flex items-center">数据周期:</span>
        <button class="period-btn active" data-period="week">周度</button>
        <button class="period-btn inactive" data-period="month">月度</button>
      </div>
      
      <!-- 数据概览卡片 -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <!-- 采购申请 -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">采购申请</p>
              <h3 class="text-3xl font-bold mt-1 data-value" data-week="32" data-month="128">32</h3>
            </div>
            <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center text-primary">
              <i class="fa fa-file-text-o text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-1 mt-2">
            <span class="text-success flex items-center text-sm data-change" data-week="+8.2%" data-month="+12.5%">
              <i class="fa fa-arrow-up mr-1"></i>8.2%
            </span>
            <span class="text-gray-400 text-sm">较上期</span>
          </div>
          <div class="flex items-center justify-between mt-2">
            <div>
              <span class="text-xs text-gray-500">待处理:</span>
              <span class="text-danger font-medium ml-1">8</span>
            </div>
            <button class="text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90 transition-colors">
              处理
            </button>
          </div>
          <div class="h-10 mt-2">
            <canvas class="sparkline" data-type="purchase-request"></canvas>
          </div>
        </div>
        
        <!-- 采购订单 -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">采购订单</p>
              <h3 class="text-3xl font-bold mt-1 data-value" data-week="24" data-month="96">24</h3>
            </div>
            <div class="w-12 h-12 rounded-full bg-secondary/10 flex items-center justify-center text-secondary">
              <i class="fa fa-shopping-cart text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-1 mt-2">
            <span class="text-success flex items-center text-sm data-change" data-week="+5.7%" data-month="+8.3%">
              <i class="fa fa-arrow-up mr-1"></i>5.7%
            </span>
            <span class="text-gray-400 text-sm">较上期</span>
          </div>
          <div class="flex items-center justify-between mt-2">
            <div>
              <span class="text-xs text-gray-500">待处理:</span>
              <span class="text-danger font-medium ml-1">5</span>
            </div>
            <button class="text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90 transition-colors">
              处理
            </button>
          </div>
          <div class="h-10 mt-2">
            <canvas class="sparkline" data-type="purchase-order"></canvas>
          </div>
        </div>
        
        <!-- 入库单 -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">入库单</p>
              <h3 class="text-3xl font-bold mt-1 data-value" data-week="18" data-month="72">18</h3>
            </div>
            <div class="w-12 h-12 rounded-full bg-success/10 flex items-center justify-center text-success">
              <i class="fa fa-sign-in text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-1 mt-2">
            <span class="text-danger flex items-center text-sm data-change" data-week="-1.2%" data-month="-3.1%">
              <i class="fa fa-arrow-down mr-1"></i>1.2%
            </span>
            <span class="text-gray-400 text-sm">较上期</span>
          </div>
          <div class="flex items-center justify-between mt-2">
            <div>
              <span class="text-xs text-gray-500">待处理:</span>
              <span class="text-danger font-medium ml-1">3</span>
            </div>
            <button class="text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90 transition-colors">
              处理
            </button>
          </div>
          <div class="h-10 mt-2">
            <canvas class="sparkline" data-type="receipt-note"></canvas>
          </div>
        </div>
        
        <!-- 发货单 -->
        <div class="stat-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">发货单</p>
              <h3 class="text-3xl font-bold mt-1 data-value" data-week="16" data-month="64">16</h3>
            </div>
            <div class="w-12 h-12 rounded-full bg-warning/10 flex items-center justify-center text-warning">
              <i class="fa fa-truck text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-1 mt-2">
            <span class="text-success flex items-center text-sm data-change" data-week="+12.3%" data-month="+15.2%">
              <i class="fa fa-arrow-up mr-1"></i>12.3%
            </span>
            <span class="text-gray-400 text-sm">较上期</span>
          </div>
          <div class="flex items-center justify-between mt-2">
            <div>
              <span class="text-xs text-gray-500">待处理:</span>
              <span class="text-danger font-medium ml-1">6</span>
            </div>
            <button class="text-xs px-2 py-1 bg-primary text-white rounded hover:bg-primary/90 transition-colors">
              处理
            </button>
          </div>
          <div class="h-10 mt-2">
            <canvas class="sparkline" data-type="delivery-order"></canvas>
          </div>
        </div>
      </div>
      
      <!-- 主要图表区域 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- 采购数量环比分析（柱状图+折线图） -->
        <div class="card">
          <div class="flex items-center justify-between mb-6">
            <h3 class="font-bold text-lg">采购数量环比分析</h3>
            <div class="flex gap-2 chart-period" data-chart="purchaseComparisonChart">
              <button class="period-btn active" data-period="week">周度</button>
              <button class="period-btn inactive" data-period="month">月度</button>
            </div>
          </div>
          <div class="h-80">
            <canvas id="purchaseComparisonChart"></canvas>
          </div>
        </div>
        
        <!-- 订单状态占比 -->
        <div class="card">
          <div class="flex items-center justify-between mb-6">
            <h3 class="font-bold text-lg">订单状态占比分析</h3>
            <div class="flex gap-2 chart-period" data-chart="orderStatusChart">
              <button class="period-btn active" data-period="week">周度</button>
              <button class="period-btn inactive" data-period="month">月度</button>
            </div>
          </div>
          <div class="h-80">
            <canvas id="orderStatusChart"></canvas>
          </div>
        </div>
      </div>
      
    </main>
  </div>

  <script>
    // 全局变量存储图表实例
    let charts = {};
    
    // 周期切换功能
    function setupPeriodToggle() {
      // 全局周期切换
      document.querySelectorAll('.period-btn[data-period]').forEach(btn => {
        btn.addEventListener('click', function() {
          const period = this.dataset.period;
          const isGlobal = !this.closest('.chart-period');
          
          // 更新按钮状态
          if (isGlobal) {
            // 全局周期切换 - 更新所有全局按钮
            document.querySelectorAll('.period-btn:not(.chart-period .period-btn)').forEach(b => {
              b.classList.remove('active', 'inactive');
              b.classList.add(b.dataset.period === period ? 'active' : 'inactive');
            });
            
            // 更新数据卡片
            document.querySelectorAll('.data-value').forEach(el => {
              el.textContent = el.dataset[period];
            });
            
            document.querySelectorAll('.data-change').forEach(el => {
              const value = el.dataset[period];
              const isPositive = value.startsWith('+');
              el.innerHTML = `<i class="fa fa-arrow-${isPositive ? 'up' : 'down'} mr-1"></i>${value.replace(/[+-]/, '')}`;
              el.className = isPositive ? 'text-success flex items-center text-sm data-change' : 'text-danger flex items-center text-sm data-change';
            });
            
            // 更新迷你图表
            if (['week', 'month'].includes(period)) {
              document.querySelectorAll('.sparkline').forEach(canvas => {
                const chartData = JSON.parse(canvas.dataset.chartData);
                if (chartData[period]) {
                  canvas.chartInstance.data.datasets[0].data = chartData[period];
                  canvas.chartInstance.update();
                }
              });
            }
          } else {
            // 单个图表周期切换
            const chartPeriod = this.closest('.chart-period');
            const chartId = chartPeriod.dataset.chart;
            
            // 更新当前图表的周期按钮
            chartPeriod.querySelectorAll('.period-btn').forEach(b => {
              b.classList.remove('active', 'inactive');
              b.classList.add(b.dataset.period === period ? 'active' : 'inactive');
            });
            
            // 更新当前图表
            updateChartPeriod(chartId, period);
          }
        });
      });
    }
    
    // 初始化迷你图表
    function initSparklineCharts() {
      document.querySelectorAll('.sparkline').forEach(canvas => {
        const ctx = canvas.getContext('2d');
        const type = canvas.dataset.type;
        
        // 不同类型图表的周期数据
        const data = {
          'purchase-request': {
            week: [5, 4, 6, 5, 7, 3, 2],
            month: [13, 5, 26, 24, 14, 25, 33, 5, 24, 28, 24, 8],
          },
          'purchase-order': {
            week: [4, 3, 5, 4, 6, 2, 2],
            month: [10, 2, 12, 14, 25, 16, 45, 10, 20, 8, 4, 23],
          },
          'receipt-note': {
            week: [3, 2, 4, 3, 5, 1, 2],
            month: [8, 2, 6, 20, 15, 14, 25, 18, 17, 14, 19, 4],
          },
          'delivery-order': {
            week: [2, 3, 4, 3, 5, 1, 2],
            month: [6, 5, 9, 11, 20, 13, 6, 17, 4, 19, 10, 18],
          }
        };
        
        // 根据类型设置颜色
        const colors = {
          'purchase-request': '#165DFF',
          'purchase-order': '#36CFC9',
          'receipt-note': '#52C41A',
          'delivery-order': '#FAAD14'
        };
        
        // 创建图表实例
        const chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: Array(data[type].week.length).fill(''),
            datasets: [{
              data: data[type].week,
              borderColor: colors[type],
              backgroundColor: `${colors[type]}33`, // 添加透明度
              borderWidth: 2,
              pointRadius: 0,
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { display: false },
              y: { display: false }
            },
            elements: { line: { tension: 0.4 } },
            animation: { duration: 1000 }
          }
        });
        
        // 存储图表数据和实例
        canvas.dataset.chartData = JSON.stringify(data[type]);
        canvas.dataset.chartColor = colors[type];
        canvas.chartInstance = chart;
      });
    }
    
    // 初始化采购数量环比分析图表（柱状图+折线图）
    function initPurchaseComparisonChart() {
      const ctx = document.getElementById('purchaseComparisonChart').getContext('2d');
      
      // 周期数据 - 包含环比增长率
      const data = {
        week: {
          labels: ['周一', '周二', '周三', '周四', '周五', '周六', '周日'],
          current: [85, 92, 105, 98, 112, 78, 65],
          previous: [72, 85, 92, 88, 105, 70, 60],
          growthRate: [18.1, 8.2, 14.1, 11.4, 6.7, 11.4, 8.3] // 环比增长率(%)
        },
        month: {
          labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
          current: [650, 780, 820, 950, 1080, 1250],
          previous: [580, 720, 760, 890, 980, 1120],
          growthRate: [12.1, 8.3, 7.9, 6.7, 10.2, 11.6] // 环比增长率(%)
        }
      };
      
      // 创建图表 - 包含柱状图(数量)和折线图(环比增长率)
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.week.labels,
          datasets: [
            {
              label: '本周期数量',
              data: data.week.current,
              backgroundColor: '#165DFF',
              borderRadius: 4,
              yAxisID: 'y' // 使用左侧Y轴
            },
            {
              label: '上周期数量',
              data: data.week.previous,
              backgroundColor: '#E8F3FF',
              borderRadius: 4,
              yAxisID: 'y' // 使用左侧Y轴
            },
            {
              label: '环比增长率(%)',
              data: data.week.growthRate,
              type: 'line',
              borderColor: '#FAAD14',
              backgroundColor: '#FAAD14',
              borderWidth: 2,
              pointBackgroundColor: '#FFFFFF',
              pointBorderColor: '#FAAD14',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6,
              tension: 0.3,
              yAxisID: 'y1' // 使用右侧Y轴
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                usePointStyle: true,
                boxWidth: 6
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.datasetIndex < 2) {
                    // 数量数据格式化
                    label += context.raw >= 1000 ? (context.raw / 1000) + 'k' : context.raw;
                  } else {
                    // 增长率数据格式化
                    label += context.raw + '%';
                  }
                  return label;
                }
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: { font: { size: 11 } }
            },
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: '采购数量',
                font: { size: 11 }
              },
              beginAtZero: true,
              grid: { color: '#F0F2F5' },
              ticks: { 
                font: { size: 11 },
                callback: function(value) {
                  return value >= 1000 ? (value / 1000) + 'k' : value;
                }
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: '环比增长率(%)',
                font: { size: 11 },
                color: '#FAAD14'
              },
              grid: {
                drawOnChartArea: false // 不在图表区域绘制网格线
              },
              ticks: { 
                font: { size: 11 },
                color: '#FAAD14',
                callback: function(value) {
                  return value + '%';
                }
              }
            }
          },
          animation: {
            duration: 1500,
            easing: 'easeOutQuart'
          },
          barPercentage: 0.6,
          categoryPercentage: 0.7
        }
      });
      
      // 存储图表数据和实例
      charts.purchaseComparisonChart = {
        instance: chart,
        data: data
      };
    }
    
    // 初始化订单状态占比图表
    function initOrderStatusChart() {
      const ctx = document.getElementById('orderStatusChart').getContext('2d');
      
      // 订单状态颜色映射
      const statusColors = {
        '新建': '#165DFF',
        '审批中': '#FAAD14',
        '审批通过': '#52C41A',
        '审批拒绝': '#FF4D4F',
        '审批撤销': '#722ED1',
        '作废': '#86909C'
      };
      
      // 周期数据
      const data = {
        week: {
          labels: ['新建', '审批中', '审批通过', '审批拒绝', '审批撤销', '作废'],
          values: [8, 12, 35, 5, 3, 2]
        },
        month: {
          labels: ['新建', '审批中', '审批通过', '审批拒绝', '审批撤销', '作废'],
          values: [10, 50, 170, 5, 4, 20]
        }
      };
      
      // 创建图表
      const chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: data.week.labels,
          datasets: [{
            data: data.week.values,
            backgroundColor: Object.values(statusColors),
            borderWidth: 0,
            hoverOffset: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                usePointStyle: true,
                boxWidth: 6,
                padding: 15
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.dataset.data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: ${value} (${percentage}%)`;
                }
              }
            }
          },
          cutout: '65%',
          animation: {
            animateRotate: true,
            animateScale: true,
            duration: 1500,
            easing: 'easeOutQuart'
          }
        }
      });
      
      // 存储图表数据和实例
      charts.orderStatusChart = {
        instance: chart,
        data: data,
        colors: statusColors
      };
    }
    
    // 更新图表周期数据
    function updateChartPeriod(chartId, period) {
      const chartInfo = charts[chartId];
      if (!chartInfo) return;
      
      const chart = chartInfo.instance;
      const data = chartInfo.data[period];
      
      if (chartId === 'purchaseComparisonChart') {
        // 更新采购对比图表（柱状图+折线图）
        chart.data.labels = data.labels;
        chart.data.datasets[0].data = data.current; // 本周期数量
        chart.data.datasets[1].data = data.previous; // 上周期数量
        chart.data.datasets[2].data = data.growthRate; // 环比增长率
      } else if (chartId === 'orderStatusChart') {
        // 更新订单状态图表
        chart.data.labels = data.labels;
        chart.data.datasets[0].data = data.values;
      } 
      
      chart.update();
    }
    
    // 初始化所有图表和交互
    document.addEventListener('DOMContentLoaded', function() {
      setupPeriodToggle();
      initSparklineCharts();
      initPurchaseComparisonChart();
      initOrderStatusChart();
    });
  </script>
</body>
</html>